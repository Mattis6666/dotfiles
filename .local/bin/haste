#!/bin/bash

HASTE_MIRROR=${HASTE_MIRROR:-https://hb.wrmsr.io}

die() {
	echo "$*"
	exit
}

create_haste() {
	res=$(wget -qO- $HASTE_MIRROR/documents --post-data="$1")
	[ -z "$res" ] && die "Failed to fetch hastebin api"
	key=$(echo "$res" | jq -r .key 2> /dev/null)
	[ -z $key ] && die "Failed to parse response"
	echo $HASTE_MIRROR/$key
}

if test ! -t 0; then
	create_haste "$(cat)"
elif [ -n "$1" ]; then
	create_haste "$*"
else
	echo "Usage: $0 <text>"
fi
